# Aseprite 文件预览器

基于 Electron 和 Node.js 实现的 Aseprite 文件预览工具，支持实时文件监控和自动刷新。

## 核心功能

- 🎨 **文件预览**: 支持 .aseprite 文件的 Canvas 渲染预览
- 📁 **文件选择**: 支持点击选择和拖拽上传
- 👁️ **实时监控**: 使用 fs.watch 监控文件变化，通过 Electron IPC 通知前端刷新
- 🔄 **自动刷新**: 文件修改后自动更新预览
- 🎛️ **图层控制**: 支持图层显示/隐藏控制，实时预览效果
- 🎬 **动画播放**: 支持多帧动画的播放控制
- 🔄 **水平翻转**: 支持图像的水平翻转显示
- 🎨 **主题切换**: 支持浅色/深色主题切换

## 技术架构

### 核心文件
- `server.js` - Node.js 服务器，提供静态文件服务
- `start.js` - 应用启动脚本，同时启动服务器和 Electron
- `electron/main.js` - Electron 主进程，处理 IPC 通信
- `electron/preload.js` - Electron 预加载脚本，暴露安全 API
- `electron/file-monitor.js` - 文件监控模块
- `public/index.html` - 前端界面
- `public/ase-canvas-renderer.js` - Canvas 渲染器
- `public/unified-file-monitor.js` - 统一文件监控管理

### 工作流程
1. 启动项目 → Electron 窗口和 Node.js 服务器同时启动
2. 选择/拖入文件 → Electron IPC 获取文件路径并解析
3. Electron 主进程 fs.watch 监控文件变化
4. 文件变动 → 通过 IPC (ipcMain.send) 通知渲染进程刷新渲染

## 快速开始

### 安装依赖
```bash
npm install
```

### 启动应用
```bash
npm start
```

## 使用说明

### 基本操作
1. 启动应用后，会同时打开 Electron 窗口和启动 Web 服务器
2. 若存在上次选择的文件，则自动加载并渲染预览
3. 点击"选择文件"按钮或直接拖拽 .aseprite 文件到界面
4. 文件会自动解析并在 Canvas 中渲染预览
5. 修改源文件后，预览会自动刷新

### 图层控制功能
1. **查看图层信息**: 加载文件后，图层控制面板会显示所有图层
2. **图层数量显示**: 面板顶部显示当前文件的图层总数
3. **图层详细信息**: 每个图层显示名称、类型、透明度、混合模式等信息
4. **切换图层可见性**: 
   - 点击图层项或可见性按钮切换单个图层的显示/隐藏
   - 使用"全部显示"/"全部隐藏"按钮批量操作
5. **实时预览**: 所有图层控制操作立即反映在预览中

### 交互控制
- **鼠标滚轮**: 缩放图像
- **鼠标拖拽**: 移动视图
- **Shift + 点击**: 反向缩放
- **动画控制**: 播放/暂停、上一帧/下一帧
- **翻转控制**: 水平翻转图像
- **主题切换**: 浅色/深色主题切换

## 依赖说明
- `ase-parser` - Aseprite 文件解析
- `express` - Web 服务器
- `electron` - 桌面应用框架，提供 IPC 通信能力